<section class="incidents-view">
  <h2>Gestión de Incidentes</h2>

  <!-- Botón Registrar -->
  <div class="actions">
    <button id="btnAddIncident" class="btn-primary">
      <i class="fas fa-plus"></i> Registrar Incidente
    </button>
  </div>

  <!-- Barra de filtros -->
  <div class="filters">
    <select id="filterType"></select>
    <select id="filterStatus"></select>
    <select id="filterPriority"></select>
    <select id="filterCode"></select>
  </div>

  <!-- Tabla de incidentes -->
  <table id="incidentsTable">
    <thead>
      <tr>
        <th data-sort="code">Incidente</th>
        <th data-sort="type">Tipo</th>
        <th data-sort="priority">Prioridad</th>
        <th data-sort="status">Estado</th>
        <th data-sort="registeredBy">Registrado por</th>
        <th data-sort="registrationDate">Fecha de registro</th>
        <th data-sort="revisionDate">Última actualización</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Modal Registrar Incidente -->
  <div id="modalAddIncident" class="modal hidden">
    <div class="modal-content">
      <h3>Registrar Incidente</h3>
      <form id="formAddIncident" enctype="multipart/form-data">
        <label for="tripSelect">Viaje *</label>
        <select id="tripSelect" required></select>

        <label for="incidentCode">Código *</label>
        <select id="incidentCode" required>
          <!-- Opciones llenadas por JS desde INCIDENT_CODES -->
        </select>

        <label for="incidentDescription">Descripción *</label>
        <textarea id="incidentDescription" required></textarea>

        <label for="relatedIncident">Incidente Relacionado (opcional)</label>
        <input type="text" id="relatedIncident" />

        <label for="incidentPictures">Fotos (opcional)</label>
        <input type="file" id="incidentPictures" accept="image/*" multiple />
        <div id="picturesPreview" style="display:flex; gap:10px; margin-top:10px;"></div>

        <div class="form-actions">
          <button type="submit" class="btn-primary">Registrar</button>
          <button type="button" class="btn-secondary btn-close">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Ver Incidente -->
  <div id="modalViewIncident" class="modal hidden">
    <div class="modal-content large">
      <h3>Detalles del Incidente</h3>
      <ul id="incidentDetails"></ul>
      <div id="incidentPicturesView" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;"></div>
      <button type="button" class="btn-secondary btn-close">Cerrar</button>
    </div>
  </div>

  <!-- Modal Editar Incidente -->
  <div id="modalEditIncident" class="modal hidden">
    <div class="modal-content">
      <h3>Editar Incidente</h3>
      <form id="formEditIncident">
        <label for="editStatus">Estado</label>
        <select id="editStatus">
          <option value="open">Abierto</option>
          <option value="inRevision">En revisión</option>
          <option value="closed">Cerrado</option>
          <option value="discarded">Descartado</option>
        </select>

        <label for="editPriority">Prioridad</label>
        <select id="editPriority">
          <option value="low">Baja</option>
          <option value="medium">Media</option>
          <option value="high">Alta</option>
        </select>

        <label for="editComments">Comentarios</label>
        <textarea id="editComments"></textarea>

        <div class="form-actions">
          <button type="submit" class="btn-primary">Actualizar</button>
          <button type="button" class="btn-secondary btn-close">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</section>
